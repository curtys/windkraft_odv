window.addEventListener("load",function(){var a=750,i=750,f=2,b=12,e=12;var c=d3.scale.ordinal().range(["#18c61a","#9817ff","#d31911","#24b7f1","#fa82ce","#736c31","#1263e2","#18c199","#ed990a","#f2917f","#7b637c","#a8b311","#a438c0","#d00d5e","#1e7b1d","#05767b","#aaa1f9","#a5aea1","#a75312","#026eb8","#94b665","#91529e","#caa74f","#c90392","#a84e5d","#6a4cf1","#1ac463","#d89ab1","#3c764d","#2dbdc5","#fb78fa","#a6a9cd","#c1383d","#8b614e","#73be38","#ff8d52","#cea37e","#b53c7e","#656d61","#436f90","#5e7304","#82b792","#fb88a3","#dd8df2","#6a5cc0","#d098d5","#ac15dc","#a4543b","#76b4cc","#6963a4","#8e620d","#77adf8","#c9a918","#99537d","#acaf7d","#7850d5","#ae3a9f","#68bd74","#e09d60","#1069cd","#d50438","#c03d17","#79b6af","#517430","#db9b94","#095cf8","#b1b045","#c0a4a9","#bc01c1","#906033","#e49c3f","#8e4db9","#bb3a64","#cb1478","#776b09","#94b743","#763eff","#1a7a3e","#617046","#915c62","#ec8dc0","#ba22ac","#437461","#913ddc","#4bbda8"]);d3.json("data/data.json",function(n,m){if(n){console.warn(n.message)}var o=m;var p=0;var l={},k={};var j=d3.scale.sqrt().domain(o.valuedomain).nice().range([3,75]);(function(){var v="#vis",s="vis1",x=[],q=[],y=0;function z(B,C){if(C.production<p||C.id==B.highestprodfacility.id){return}var A=C;A.cluster=B.abbr;A.clusterid=y;A.radius=j(C.production);q.push(A)}o.cantons.forEach(function(B){if(!B.highestprodfacility){return}var A=dataViewUtility.clone(B.highestprodfacility);A.cluster=B.abbr;A.clusterid=y;A.radius=j(B.highestprodfacility.production);x.push(A);q.push(x[y]);B.hydropowerplants.forEach(function(C){z(B,C)});B.nuclearpowerplants.forEach(function(C){z(B,C)});B.windenergyplants.forEach(function(C){z(B,C)});y++});function t(C,A){var B="https://map.geo.admin.ch/?X="+C[1]+"&Y="+C[0]+"&zoom=8&bgLayer=ch.swisstopo.pixelkarte-farbe&layers=";if(A=="Wasserkraftwerk"){B+="ch.bfe.statistik-wasserkraftanlagen"}else{if(A=="Kernkraftwerk"){B+="ch.bfe.kernkraftwerke"}else{if(A=="Windenergieanlage"){B+="ch.bfe.windenergieanlagen"}}}return B}function r(C){var B="",A=document.querySelector("#legend-cont");C.forEach(function(D){var E=c(D.clusterid);var F=dataViewUtility.getCantonByAbbr(o,D.cluster,true);var G=F.name;B+='<li><span style="background-color: '+E+';"></span>'+G+"</li>"});A.innerHTML=B}var w=(function(F){var C,B,G="#2299dd",E=document.querySelector("#descr"),A=document.querySelector("#backup-descr"),D="hidden";return function(O){if(C){d3.select(C).style("fill",B);if(C==this){C=null;E.innerHTML="";A.innerHTML="";return}}B=d3.select(this).style("fill");d3.select(this).style("fill",G);C=this;var R=t(O.coordinate,O.type);var V=dataViewUtility.getCantonByAbbr(o,O.cluster,true);var S=V.hydropowerproduction+V.nuclearenergyproduction+V.windenergyproduction;var T=Math.round((O.production/S)*1000)/10;var H=Math.round((O.production/o.annualenergyproduction)*10000)/100;H=(H<0.01)?"weniger als 0.01":H;var K=Math.round((V.windenergyproduction/S)*1000)/10;var P=Math.round((V.hydropowerproduction/S)*1000)/10;var M=Math.round((V.nuclearenergyproduction/S)*1000)/10;var L="<br><strong>Kanton "+V.name+"</strong><br>Ganzjährliche Produktion von<br>Wasserkraft: <strong>"+V.hydropowerproduction+"</strong> GWh<br>Kernenergie: <strong>"+V.nuclearenergyproduction+"</strong> GWh<br>Windenergie: <strong>"+V.windenergyproduction+"</strong> GWh<br>Total: <strong>"+S+"</strong> GWh<br><br><strong>"+O.type+" "+O.name+"</strong><br>Produktion: "+O.production+" GWh<br>"+Math.round((O.production/S)*1000)/10+"% der kantonalen Produktion<br>";var J="Das "+O.type+" <strong>"+O.name+"</strong> deckt "+T+"% der Produktion des Kt "+V.name+" (Wind: "+K+"%, Wasser: "+P+"%, KKW: "+M+"%) oder "+H+'% der Schweizer Energieproduktion.<br><br><a target="_blank" href="'+R+'"> zeige auf Karte (extern)</a><br><label id="ext"> Ausführlich</label><br><div id="descr-ext">'+L+"</div>";E.innerHTML=A.innerHTML=J;var N=document.querySelectorAll("#ext");var U=document.querySelectorAll("#descr-ext");for(var Q=0;Q<U.length;Q++){if(D=="visible"){U[Q].style.visibility="visible"}else{U[Q].style.visibility="hidden"}}for(var I=0;I<N.length;I++){N[I].onclick=function(){for(var X=0;X<U.length;X++){var W=U[X].style.visibility;if(W=="visible"){U[X].style.visibility=D="hidden"}else{U[X].style.visibility=D="visible"}}}}}})();var u=(function(A){return function(B){return B.type+" "+B.name+"<br>"+B.production+" GWh"}})();d(v,s,q,x,w,u);r(x)})()});function d(r,s,k,v,t,o){d3.layout.pack().sort(null).size([a,i]).children(function(x){return x.values}).value(function(x){return x.radius*x.radius}).nodes({values:d3.nest().key(function(x){return x.clusterid}).entries(k)});var l=d3.layout.force().nodes(k).size([a,i]).gravity(0.01).charge(0).on("tick",m).start();var w=d3.tip().attr("class","d3-tip").offset([-15,0]).html(o);var q=(function(x){return function(A){var y=d3.select(this).attr("cx"),z=140;if(y<z){w.direction("e").offset([0,10])}else{if(y>window.innerWidth-z){w.direction("w").offset([0,-10])}else{w.direction("n").offset([-15,0])}}w.show(A)}})();var n=d3.select(r).append("svg").classed(s,true).attr("width",a).attr("height",i).attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+a+" "+i);n.call(w);var j=n.selectAll("circle."+s).data(k).enter().append("circle").classed(s,true).attr("r",function(x){return x.radius}).style("fill",function(x){return c(x.clusterid)}).call(l.drag).on("mousedown.drag",null).on("click",t);if(window.innerWidth>=500){j.on("mouseover",q).on("mouseout",w.hide)}var u=window.innerWidth,p;window.addEventListener("resize",function(){p=window.innerWidth;if(window.innerWidth<500){j.on("mouseover",null).on("mouseout",null)}else{if(u<500&&p>=500){j.on("mouseover",q).on("mouseout",w.hide)}}u=p});setTimeout(function(){l.on("tick",null).stop()},20000);function m(x){j.each(g(10*x.alpha*x.alpha,v)).each(h(0.5,k)).attr("cx",function(y){return y.x}).attr("cy",function(y){return y.y})}}function g(k,j){return function(s){var n=j[s.clusterid],p=1;if(n===s){n={x:a/2,y:i/2,radius:-s.radius};p=0.1*Math.sqrt(s.radius)}var m=s.x-n.x,t=s.y-n.y,o=Math.sqrt(m*m+t*t),q=s.radius+n.radius;if(o!=q){o=(o-q)/o*k*p;s.x-=m*=o;s.y-=t*=o;n.x+=m;n.y+=t}}}function h(l,k){var j=d3.geom.quadtree(k);return function(s){var q=s.radius+e+Math.max(f,b),n=s.x-q,m=s.x+q,p=s.y-q,o=s.y+q;j.visit(function(D,v,B,u,A){if(D.point&&(D.point!==s)){var C=s.x-D.point.x,z=s.y-D.point.y,w=Math.sqrt(C*C+z*z),t=s.radius+D.point.radius+(s.cluster===D.point.cluster?f:b);if(w<t){w=(w-t)/w*l;s.x-=C*=w;s.y-=z*=w;D.point.x+=C;D.point.y+=z}}return v>m||u<n||B>o||A<p})}}});