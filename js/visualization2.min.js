window.addEventListener("load",function(){var a=1000,i=1000,f=2,b=12,e=12;var c=d3.scale.ordinal().range(["#18c61a","#9817ff","#d31911","#24b7f1","#fa82ce","#736c31","#1263e2","#18c199","#ed990a","#f2917f","#7b637c","#a8b311","#a438c0","#d00d5e","#1e7b1d","#05767b","#aaa1f9","#a5aea1","#a75312","#026eb8","#94b665","#91529e","#caa74f","#c90392","#a84e5d","#6a4cf1","#1ac463","#d89ab1","#3c764d","#2dbdc5","#fb78fa","#a6a9cd","#c1383d","#8b614e","#73be38","#ff8d52","#cea37e","#b53c7e","#656d61","#436f90","#5e7304","#82b792","#fb88a3","#dd8df2","#6a5cc0","#d098d5","#ac15dc","#a4543b","#76b4cc","#6963a4","#8e620d","#77adf8","#c9a918","#99537d","#acaf7d","#7850d5","#ae3a9f","#68bd74","#e09d60","#1069cd","#d50438","#c03d17","#79b6af","#517430","#db9b94","#095cf8","#b1b045","#c0a4a9","#bc01c1","#906033","#e49c3f","#8e4db9","#bb3a64","#cb1478","#776b09","#94b743","#763eff","#1a7a3e","#617046","#915c62","#ec8dc0","#ba22ac","#437461","#913ddc","#4bbda8"]);d3.json("data/data.json",function(n,m){if(n){console.warn(n.message)}var o=m;var p=0;var l={},k={};var j=d3.scale.sqrt().domain(o.valuedomain).nice().range([3,75]);(function(){var x="#vis",u="vis2",A=[],r=[],B=0,t=3;function C(E,G){var F=G;F.cluster=E.id;F.clusterid=B;F.radius=j(G.production);r.push(F);if(F.id==E.id){A.push(F)}}var z=dataViewUtility.createJointArray(o,"hydropowerplants"),D=dataViewUtility.createJointArray(o,"windenergyplants"),q=dataViewUtility.createJointArray(o,"nuclearpowerplants");z.forEach(function(E){C(o.globalHPFacilityHydro,E)});B++;D.forEach(function(E){C(o.globalHPFacilityWind,E)});B++;q.forEach(function(E){C(o.globalHPFacilityNuclear,E)});function v(G,E){var F="https://map.geo.admin.ch/?X="+G[1]+"&Y="+G[0]+"&zoom=8&bgLayer=ch.swisstopo.pixelkarte-farbe&layers=";if(E=="Wasserkraftwerk"){F+="ch.bfe.statistik-wasserkraftanlagen"}else{if(E=="Kernkraftwerk"){F+="ch.bfe.kernkraftwerke"}else{if(E=="Windenergieanlage"){F+="ch.bfe.windenergieanlagen"}}}return F}function s(G){var F="",E=document.querySelector("#legend-cont");G.forEach(function(H){var I=c(H.clusterid);var J=H.type;F+='<li><span style="background-color: '+I+';"></span>'+J+"</li>"});E.innerHTML=F}var y=(function(J){var G,F,K="#2299dd",I=document.querySelector("#descr"),E=document.querySelector("#backup-descr"),H="hidden";return function(T){if(G){d3.select(G).style("fill",F);if(G==this){G=null;I.innerHTML="";E.innerHTML="";return}}F=d3.select(this).style("fill");d3.select(this).style("fill",K);G=this;var W="";var O;if(T.type=="Wasserkraftwerk"){W="Wasserkraft";O=o.globalhydropowerproduction}else{if(T.type=="Kernkraftwerk"){W="Kernkraft";O=o.globalnuclearenergyprodution}else{if(T.type=="Windenergieanlage"){W="Windkraft";O=o.globalwindenergyproduction}}}var Y=dataViewUtility.getCantonByPlantId(o,T.id,true);var N=Math.round((O/o.annualenergyproduction)*1000)/10;var S=Math.round((T.production/O)*10000)/100;var L=Math.round((T.production/o.annualenergyproduction)*10000)/100;S=(S<1)?Math.round((T.production/O)*100000)/1000:S;L=(L<0.01)?"weniger als 0.01":L;var V=v(T.coordinate,T.type);var Q="<br><strong>"+W+"</strong><br>Ganzjährliche Produktion von "+W+":<br><strong>"+O+"</strong> GWh<br>"+N+"% der schweizerischen Energieproduktion (Net "+o.asat+")<br><br><strong>"+T.name+"</strong><br>Kanton "+Y.name+"<br>Produktion: <strong>"+T.production+"</strong> GWh<br>"+S+"% der Gesamtproduktion von "+W;var P="Das "+T.type+" <strong>"+T.name+"</strong> liefert "+L+'% der Schweizer Energieproduktion<br><a target="_blank" href="'+V+'">&#10148; Zeige auf Karte (extern)</a><br><label id="ext"> Ausführlich</label><br><div id="descr-ext">'+Q+"</div>";I.innerHTML=E.innerHTML=P;var R=document.querySelectorAll("#ext");var X=document.querySelectorAll("#descr-ext");for(var U=0;U<X.length;U++){if(H=="visible"){X[U].style.visibility="visible"}else{X[U].style.visibility="hidden"}}for(var M=0;M<R.length;M++){R[M].onclick=function(){for(var aa=0;aa<X.length;aa++){var Z=X[aa].style.visibility;if(Z=="visible"){X[aa].style.visibility=H="hidden"}else{X[aa].style.visibility=H="visible"}}}}}})();var w=(function(E){return function(F){return F.type+" "+F.name+"<br>"+F.production+" GWh"}})();d(x,u,r,A,y,w);s(A)})()});function d(r,s,k,v,t,o){d3.layout.pack().sort(null).size([a,i]).children(function(x){return x.value}).value(function(x){return x.radius*x.radius}).nodes({values:d3.nest().key(function(x){return x.clusterid}).entries(k)});var l=d3.layout.force().nodes(k).size([a,i]).gravity(0.01).charge(0).on("tick",m).start();var w=d3.tip().attr("class","d3-tip").offset([-15,0]).html(o);var q=(function(x){return function(A){var y=d3.select(this).attr("cx"),z=120;if(y<z){w.direction("e").offset([0,10])}else{if(y>window.innerWidth-z){w.direction("w").offset([0,-10])}else{w.direction("n").offset([-15,0])}}w.show(A)}})();var n=d3.select(r).append("svg").classed(s,true).attr("width",a).attr("height",i).attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+a+" "+i);n.call(w);var j=n.selectAll("circle."+s).data(k).enter().append("circle").classed(s,true).attr("r",function(x){return x.radius}).style("fill",function(x){return c(x.clusterid)}).call(l.drag).on("mousedown.drag",null).on("click",t);if(window.innerWidth>=500){j.on("mouseover",q).on("mouseout",w.hide)}var u=window.innerWidth,p;window.addEventListener("resize",function(){p=window.innerWidth;if(window.innerWidth<500){j.on("mouseover",null).on("mouseout",null)}else{if(u<500&&p>=500){j.on("mouseover",q).on("mouseout",w.hide)}}u=p});setTimeout(function(){l.on("tick",null).stop()},40000);function m(x){j.each(g(10*x.alpha*x.alpha,v)).each(h(0.5,k)).attr("cx",function(y){return y.x}).attr("cy",function(y){return y.y})}}function g(k,j){return function(s){var n=j[s.clusterid],p=1;if(n===s){n={x:a/2,y:i/2,radius:-s.radius};p=0.1*Math.sqrt(s.radius)}var m=s.x-n.x,t=s.y-n.y,o=Math.sqrt(m*m+t*t),q=s.radius+n.radius;if(o!=q){o=(o-q)/o*k*p;s.x-=m*=o;s.y-=t*=o;n.x+=m;n.y+=t}}}function h(l,k){var j=d3.geom.quadtree(k);return function(s){var q=s.radius+e+Math.max(f,b),n=s.x-q,m=s.x+q,p=s.y-q,o=s.y+q;j.visit(function(D,v,B,u,A){if(D.point&&(D.point!==s)){var C=s.x-D.point.x,z=s.y-D.point.y,w=Math.sqrt(C*C+z*z),t=s.radius+D.point.radius+(s.cluster===D.point.cluster?f:b);if(w<t){w=(w-t)/w*l;s.x-=C*=w;s.y-=z*=w;D.point.x+=C;D.point.y+=z}}return v>m||u<n||B>o||A<p})}}});